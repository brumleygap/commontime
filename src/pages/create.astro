---
import BaseLayout from "../layouts/BaseLayout.astro";
import { actions } from "astro:actions";

const result = await Astro.getActionResult(actions.createPoll);

if (result?.data && (result.data as any).ok) {
  const token = (result.data as any).token;
  return Astro.redirect(`/poll/${token}`);
}
---



<BaseLayout title="Create Poll">
  <section class="mx-auto max-w-3xl px-4 py-12">
    <h2 class="text-2xl font-bold">
      Create a poll
    </h2>

    <p class="mt-2 text-slate-600">
      Give it a name and choose possible dates and times.
    </p>

{result?.error && (
  <div class="mt-4 rounded-md border border-red-300 bg-red-50 p-4 text-red-800">
    <p class="font-semibold">Fix these:</p>
    <pre class="mt-2 text-sm whitespace-pre-wrap">{JSON.stringify(result.error, null, 2)}</pre>
  </div>
)}

    <form method="POST" action={actions.createPoll} class="mt-8 space-y-6">
       <input type="hidden" name="timezone" value="America/New_York" />
      <!-- Poll title -->
      <div>
        <label for="title" class="block text-sm font-medium text-slate-700">
          Poll title
        </label>
        <input
          id="title"
          name="title"
          type="text" required
          placeholder="Band rehearsal"
          class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-red-500 focus:ring-red-500"
        />
      </div>

      <!-- Description -->
      <div>
        <label for="description" class="block text-sm font-medium text-slate-700">
          Description (optional)
        </label>
        <textarea
          id="description"
          name="description"
          rows="3"
          placeholder="Rehearsal at 'the studio'"
          class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-red-500 focus:ring-red-500"
        ></textarea>
      </div>

      <div>
  <label class="block text-sm font-medium text-slate-700">
    Date & time options
  </label>

<input type="datetime-local" name="options" required
class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-red-500 focus:ring-red-500"/>
<input type="datetime-local" name="options" 
class="mt-2 block w-full rounded-md border-slate-300 shadow-sm focus:border-red-500 focus:ring-red-500"/>

  <p class="mt-2 text-xs text-slate-500">
    Add at least one option. (Weâ€™ll make this dynamic next.)
  </p>
</div>


      <!-- Actions -->
      <div class="flex justify-end gap-3">
        <a
          href="/"
          class="rounded-md border px-4 py-2 text-sm text-slate-700 hover:bg-slate-100"
        >
          Cancel
        </a>
        <button
          type="submit"
          class="rounded-md bg-red-600 px-5 py-2 text-sm font-semibold text-white hover:bg-red-700"
        >
          Create poll
        </button>
      </div>
    </form>
  </section>
</BaseLayout>
